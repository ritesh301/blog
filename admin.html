<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blogzy Admin Dashboard - Manage your blogs and content.">
    <title>Admin Dashboard | Blogzy</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    
    <!-- Login Section -->
    <div id="loginSection" class="admin-login">
        <div class="container">
            <div class="login-card">
                <div class="text-center mb-4">
                    <i class="fas fa-shield-alt fa-3x mb-3" style="color: var(--primary-color);"></i>
                    <h2>Admin Login</h2>
                    <p class="text-secondary">Enter your credentials to access the dashboard</p>
                </div>
                
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input type="text" class="form-control" id="username" placeholder="Enter username">
                        <div class="error-message"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control" id="password" placeholder="Enter password">
                        <div class="error-message"></div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 btn-lg">
                        <i class="fas fa-sign-in-alt me-2"></i>Login
                    </button>
                    
                    <div class="text-center mt-3">
                        <a href="index.html" class="text-decoration-none">
                            <i class="fas fa-arrow-left me-2"></i>Back to Home
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard Section -->
    <div id="dashboardSection" style="display: none;">
        
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="index.html">
                    <i class="fas fa-blog"></i>
                    Blogzy Admin
                </a>
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">
                                <i class="fas fa-home me-2"></i>View Website
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="write-blog.html">
                                <i class="fas fa-pen me-2"></i>Write Blog
                            </a>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link btn btn-link" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </li>
                    </ul>
                    
                    <button class="theme-toggle" type="button" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Header -->
        <section class="bg-gradient text-white py-4">
            <div class="container-fluid">
                <h1><i class="fas fa-tachometer-alt me-3"></i>Admin Dashboard</h1>
                <p class="mb-0">Manage your blogs, monitor statistics, and control content</p>
            </div>
        </section>

        <!-- Statistics Cards -->
        <section class="py-4" style="background-color: var(--bg-secondary);">
            <div class="container-fluid">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-blog"></i>
                        <h3 id="totalBlogs">0</h3>
                        <p>Total Blogs</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-layer-group"></i>
                        <h3 id="totalCategories">0</h3>
                        <p>Categories</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-heart"></i>
                        <h3 id="totalLikes">0</h3>
                        <p>Total Likes</p>
                    </div>
                    
                    <div class="stat-card">
                        <i class="fas fa-envelope"></i>
                        <h3 id="totalContacts">0</h3>
                        <p>Contact Messages</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Blogs Management -->
        <section class="py-5">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-list me-3"></i>Manage Blogs</h2>
                    <div>
                        <button class="btn btn-success me-2" onclick="exportBlogs()">
                            <i class="fas fa-download me-2"></i>Export Data
                        </button>
                        <label class="btn btn-info me-2" for="importFile">
                            <i class="fas fa-upload me-2"></i>Import Data
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importBlogs(event)">
                        </label>
                        <a href="write-blog.html" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Add New Blog
                        </a>
                    </div>
                </div>
                
                <div class="admin-table">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="35%">Title</th>
                                    <th width="15%">Author</th>
                                    <th width="15%">Category</th>
                                    <th width="15%">Date</th>
                                    <th width="15%">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="blogsTableBody">
                                <!-- Blogs will be loaded dynamically -->
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading blogs...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Messages -->
        <section class="py-5" style="background-color: var(--bg-secondary);">
            <div class="container-fluid">
                <h2 class="mb-4"><i class="fas fa-envelope-open me-3"></i>Contact Messages</h2>
                
                <div class="admin-table">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th width="5%">#</th>
                                    <th width="20%">Name</th>
                                    <th width="25%">Email</th>
                                    <th width="30%">Subject</th>
                                    <th width="15%">Date</th>
                                    <th width="5%">Action</th>
                                </tr>
                            </thead>
                            <tbody id="contactsTableBody">
                                <!-- Contacts will be loaded dynamically -->
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <i class="fas fa-envelope-open fa-3x mb-3" style="color: var(--border-color);"></i>
                                        <p>No contact messages yet.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Danger Zone -->
        <section class="py-5">
            <div class="container-fluid">
                <div class="alert alert-danger">
                    <h4><i class="fas fa-exclamation-triangle me-2"></i>Danger Zone</h4>
                    <p>The following actions are irreversible. Please proceed with caution.</p>
                    <button class="btn btn-danger" onclick="confirmDeleteAllBlogs()">
                        <i class="fas fa-trash-alt me-2"></i>Delete All Blogs
                    </button>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="margin-top: 0;">
            <div class="container-fluid">
                <div class="footer-bottom" style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <p>&copy; 2025 Blogzy Admin Panel. All rights reserved.</p>
                </div>
            </div>
        </footer>

    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/main.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/blogs.js"></script>
    <script src="js/admin.js"></script>
    
    <script>
        // Handle admin login form
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const result = await api.adminLogin({ username, password });
                
                console.log('Login result:', result);
                console.log('Result success:', result?.success);
                console.log('Result user:', result?.user);
                console.log('Result token:', result?.token);
                
                if (result && result.success) {
                    // Data is already saved by the API function
                    // Just verify and redirect
                    const savedUser = localStorage.getItem('user');
                    const savedToken = localStorage.getItem('token');
                    console.log('Saved user in localStorage:', savedUser);
                    console.log('Saved token in localStorage:', savedToken);
                    
                    // Parse and verify
                    if (savedUser) {
                        const userObj = JSON.parse(savedUser);
                        console.log('Parsed user object:', userObj);
                        console.log('User role:', userObj.role);
                    }
                    
                    // Small delay to ensure localStorage is written
                    setTimeout(() => {
                        console.log('Redirecting to dashboard...');
                        window.location.href = 'admin-dashboard.html';
                    }, 100);
                } else {
                    console.error('Login failed:', result);
                    alert('Error: ' + (result?.message || 'Login failed'));
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Error during login');
            }
        });
        
        // Check if already logged in
        document.addEventListener('DOMContentLoaded', function() {
            const userStr = localStorage.getItem('user');
            const user = (userStr && userStr !== 'undefined' && userStr !== 'null') ? JSON.parse(userStr) : null;
            if (user && user.role === 'admin') {
                window.location.href = 'admin-dashboard.html';
            }
        });
    </script>
    
</body>
</html>
